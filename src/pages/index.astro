---
const BRAND = "HIDRACODE SOLUTIONS";
const WHATSAPP = "https://wa.me/56940752095";
const EMAIL = "contacto.hidracode@gmail.com";
---

<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/png" href="/favicon.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>{BRAND}</title>
    <meta
      name="description"
      content="Branding, marketing y desarrollo de software a medida para pymes y emprendedores en Chile."
    />

    <link rel="stylesheet" href="/styles/global.css" />
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const header = document.querySelector(".header");
        if (!header) return;

        window.addEventListener("scroll", () => {
          if (window.scrollY > 20) {
            header.classList.add("header--scrolled");
          } else {
            header.classList.remove("header--scrolled");
          }
        });
      });
    </script>
  </head>

  <body>
    <header class="header">
      <div class="container header__inner">
        <a class="brand" href="#inicio" aria-label={BRAND}>
          <img
            src="/img/logohidracodepng.png"
            alt="HIDRACODE SOLUTIONS"
            class="brand__logo"
          />
          <span class="sr-only">HIDRACODE SOLUTIONS</span>
        </a>

        <nav class="nav" aria-label="Navegaci√≥n">
          <a href="#servicios">Servicios</a>
          <a href="#proceso">Proceso</a>
          <a href="#contacto">Contacto</a>
          <a class="nav__cta" href="#contacto">Cotizar</a>
        </nav>
      </div>
    </header>

    <main id="inicio">
      <section class="hero">
        <div class="container hero__grid">
          <div>
            <p class="kicker">Dise√±o + Tecnolog√≠a para pymes</p>
            <h1>Dise√±o y tecnolog√≠a que hacen crecer tu negocio</h1>
            <p class="lead">
              Branding, marketing y desarrollo de software a medida para
              emprendedores y pymes. Entregamos soluciones claras, modernas y
              escalables.
            </p>

            <div class="hero__cta">
              <a class="btn btn--primary" href="#contacto"> Cotizar ahora </a>
              <a class="btn btn--ghost" href="#servicios">Ver servicios</a>
            </div>

            <div class="hero__badges" aria-label="Beneficios">
              <span>Respuesta r√°pida</span>
              <span>Enfoque pyme</span>
              <span>Soluciones a medida</span>
            </div>
          </div>

          <div class="hero__card" aria-label="Resumen">
            <div class="card">
              <h2>¬øQu√© hacemos?</h2>
              <p>
                Unimos dise√±o y tecnolog√≠a para que tu negocio se vea
                profesional y funcione mejor.
              </p>

              <div class="card__cols">
                <div>
                  <h3>Dise√±o</h3>
                  <ul>
                    <li>Branding</li>
                    <li>Marketing</li>
                    <li>Redes sociales</li>
                    <li>Packaging</li>
                    <li>Video</li>
                  </ul>
                </div>
                <div>
                  <h3>Tecnolog√≠a</h3>
                  <ul>
                    <li>Software a medida</li>
                    <li>Web</li>
                    <li>Apps m√≥viles</li>
                    <li>Consultor√≠a TI</li>
                  </ul>
                </div>
              </div>

              <a class="link" href="#contacto">Cu√©ntanos tu idea ‚Üí</a>
            </div>
          </div>
        </div>
      </section>

      <section id="servicios" class="section">
        <div class="container">
          <h2 class="section__title">Servicios</h2>
          <p class="section__desc">
            Dise√±amos, construimos y optimizamos soluciones para emprendedores y
            pymes.
          </p>

          <div class="grid">
            <article class="tile">
              <h3>Branding</h3>
              <p>
                Identidad visual, lineamientos y material para una marca
                consistente.
              </p>
              <ul>
                <li>Logo e identidad</li>
                <li>Manual de marca</li>
                <li>Brochures e infograf√≠as</li>
              </ul>
            </article>

            <article class="tile">
              <h3>Marketing y Redes</h3>
              <p>Dise√±o y contenido para comunicar mejor y vender m√°s.</p>
              <ul>
                <li>Dise√±o para RRSS</li>
                <li>Flyers, afiches</li>
                <li>Direcci√≥n creativa</li>
              </ul>
            </article>

            <article class="tile">
              <h3>Packaging</h3>
              <p>Dise√±o de envases y piezas gr√°ficas listas para impresi√≥n.</p>
              <ul>
                <li>Etiquetas</li>
                <li>Empaques</li>
                <li>Mockups</li>
              </ul>
            </article>

            <article class="tile">
              <h3>Video</h3>
              <p>Edici√≥n y direcci√≥n para piezas promocionales y contenido.</p>
              <ul>
                <li>Edici√≥n</li>
                <li>Reels / c√°psulas</li>
                <li>Guion y direcci√≥n</li>
              </ul>
            </article>

            <article class="tile">
              <h3>Desarrollo de Software</h3>
              <p>
                Sistemas a medida para digitalizar procesos y ahorrar tiempo.
              </p>
              <ul>
                <li>Levantamiento</li>
                <li>MVP</li>
                <li>Escalabilidad</li>
              </ul>
            </article>

            <article class="tile">
              <h3>Web y Apps</h3>
              <p>Sitios modernos y aplicaciones para operar y crecer.</p>
              <ul>
                <li>Landing / corporativa</li>
                <li>Paneles y sistemas</li>
                <li>Apps m√≥viles</li>
              </ul>
            </article>
          </div>
        </div>
      </section>

      <section id="ia-analyzer" class="section section--dark reveal">
        <div class="container">
          <div class="card analyzer">
            <div class="analyzer__header">
              <span class="step__num">Beta IA</span>
              <h2 class="section__title">Analizador de Identidad Visual</h2>
              <p class="section__desc">
                Sube tu logo y nuestra IA har√° un an√°lisis autom√°tico basado en criterios de branding profesional.
              </p>
            </div>

            <div class="analyzer__grid">
              <div class="analyzer__upload" id="dropzone">
                <input type="file" id="logoInput" accept="image/*" hidden />
                <div class="upload__content" id="uploadContent">
                  <div class="upload__icon">üìÅ</div>
                  <p>Arrastra tu logo o <span>haz clic para buscar</span></p>
                  <small>PNG, JPG o SVG (Max 2MB)</small>
                </div>
                <img
                  id="logoPreview"
                  class="logo-preview hidden"
                  src=""
                  alt="Vista previa"
                />
              </div>

              <div id="results" class="analyzer__results hidden">
                <div class="result-item">
                  <h4>Colores detectados</h4>
                  <div id="colorPalette" class="palette"></div>
                </div>
                <div class="result-item">
                  <h4>Diagn√≥stico y recomendaciones</h4>
                  <ul id="healthReport" class="health-list"></ul>
                </div>
                <p class="analyzer__cta-text">
                  Detectamos oportunidades claras de mejora. Te enviamos una
                  propuesta breve (sin costo).
                </p>

                <a href="#contacto" class="btn btn--primary btn--small">
                  Recibir propuesta de mejora (sin costo)
                </a>
              </div>
            </div>

            <div id="loadingBar" class="loading-bar hidden">
              <div class="loading-bar__fill"></div>
            </div>
          </div>
        </div>
      </section>

      <section id="proceso" class="section section--dark reveal">
        <div class="container">
          <h2 class="section__title">C√≥mo trabajamos</h2>
          <p class="section__desc">
            Un proceso claro, simple y orientado a resultados.
          </p>

          <div class="steps">
            <div class="step">
              <span class="step__num">01</span>
              <h3>Diagn√≥stico</h3>
              <p>Entendemos tu negocio, objetivos y prioridades.</p>
            </div>
            <div class="step">
              <span class="step__num">02</span>
              <h3>Propuesta</h3>
              <p>Definimos alcance, plazos y entregables con claridad.</p>
            </div>
            <div class="step">
              <span class="step__num">03</span>
              <h3>Ejecuci√≥n</h3>
              <p>Dise√±amos y desarrollamos con revisiones controladas.</p>
            </div>
            <div class="step">
              <span class="step__num">04</span>
              <h3>Entrega y Soporte</h3>
              <p>
                Implementamos y dejamos todo funcionando, con acompa√±amiento.
              </p>
            </div>
          </div>
        </div>
      </section>

      <section id="contacto" class="section reveal">
        <div class="container contact">
          <div>
            <h2 class="section__title">Contacto</h2>
            <p class="section__desc">
              Cu√©ntanos qu√© necesitas y te respondemos con una propuesta clara.
            </p>

            <div class="contact__cards">
              <a
                class="contact__card"
                href={WHATSAPP}
                target="_blank"
                rel="noreferrer"
              >
                <h3>WhatsApp</h3>
                <p>Respuesta r√°pida para cotizar.</p>
              </a>

              <a class="contact__card" href={`mailto:${EMAIL}`}>
                <h3>Email</h3>
                <p>{EMAIL}</p>
              </a>
            </div>
          </div>

          <form class="form" onsubmit="return false">
            <label>
              Nombre
              <input
                type="text"
                name="nombre"
                placeholder="Tu nombre"
                required
              />
            </label>

            <label>
              Empresa (opcional)
              <input
                type="text"
                name="empresa"
                placeholder="Nombre de tu negocio"
              />
            </label>

            <label>
              ¬øQu√© necesitas?
              <select name="servicio" required>
                <option value="">Selecciona un servicio</option>
                <option>Branding</option>
                <option>Marketing y redes</option>
                <option>Packaging</option>
                <option>Video</option>
                <option>Desarrollo de software</option>
                <option>Web / Apps</option>
                <option>Consultor√≠a TI</option>
              </select>
            </label>

            <label>
              Mensaje
              <textarea
                name="mensaje"
                rows="4"
                placeholder="Cu√©ntanos tu idea..."
                required></textarea>
            </label>

            <button class="btn btn--primary" id="btnEnviar"
              >Enviar por WhatsApp</button
            >
            <p class="form__hint">
              Este formulario env√≠a el mensaje directo a WhatsApp.
            </p>
          </form>
        </div>
      </section>
    </main>

    <footer class="footer">
      <div class="container footer__inner">
        <small
          >¬© {new Date().getFullYear()} HIDRACODE SOLUTIONS. Concepci√≥n. Chile.</small
        >
        <a class="link" href="#inicio">Volver arriba</a>
      </div>
    </footer>

    <script>
      const WHATSAPP_URL = "https://wa.me/56940752095";

      const btn = document.getElementById("btnEnviar");

      btn?.addEventListener("click", () => {
        const nombreEl = document.querySelector<HTMLInputElement>(
          'input[name="nombre"]'
        );
        const empresaEl = document.querySelector<HTMLInputElement>(
          'input[name="empresa"]'
        );
        const servicioEl = document.querySelector<HTMLSelectElement>(
          'select[name="servicio"]'
        );
        const mensajeEl = document.querySelector<HTMLTextAreaElement>(
          'textarea[name="mensaje"]'
        );

        if (!nombreEl || !servicioEl || !mensajeEl) return;

        const nombre = nombreEl.value.trim();
        const empresa = (empresaEl?.value ?? "").trim();
        const servicio = servicioEl.value;
        const mensaje = mensajeEl.value.trim();

        const texto = `Hola Hidracode, soy ${nombre}${empresa ? " de " + empresa : ""}. Necesito: ${servicio}. ${mensaje}`;
        const url = `${WHATSAPP_URL}?text=${encodeURIComponent(texto)}`;

        window.open(url, "_blank");
      });
    </script>

    <script>
      const reveals = document.querySelectorAll(".reveal");

      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              entry.target.classList.add("reveal--visible");
              observer.unobserve(entry.target);
            }
          });
        },
        { threshold: 0.15 }
      );

      reveals.forEach((el) => observer.observe(el));
    </script>

    <script>
      const logoInput = document.getElementById(
        "logoInput"
      ) as HTMLInputElement | null;
      const preview = document.getElementById(
        "logoPreview"
      ) as HTMLImageElement | null;
      const results = document.getElementById("results");
      const loadingBar = document.getElementById("loadingBar");
      const loadingFill = document.querySelector(
        ".loading-bar__fill"
      ) as HTMLElement | null;
      const report = document.getElementById("healthReport");
      const palette = document.getElementById("colorPalette");

      document
        .getElementById("dropzone")
        ?.addEventListener("click", () => logoInput?.click());

      logoInput?.addEventListener("change", async (e: Event) => {
        const target = e.target as HTMLInputElement;
        const file = target.files?.[0];

        if (file && preview) {
          // 1. Mostrar vista previa local
          preview.src = URL.createObjectURL(file);
          preview.classList.remove("hidden");
          document.getElementById("uploadContent")?.classList.add("hidden");

          // 2. Iniciar carga
          startAI(file);
        }
      });

      async function startAI(file: File) {
        if (!loadingBar || !loadingFill || !results) return;

        loadingBar.classList.remove("hidden");
        results.classList.add("hidden");
        loadingFill.style.width = "60%"; // Carga simulada mientras la IA piensa

        const formData = new FormData();
        formData.append("image", file);

        try {
          const response = await fetch("/api/analyze", {
            method: "POST",
            body: formData,
          });

          const data = await response.json();
          loadingFill.style.width = "100%";

          setTimeout(() => {
            showAIResults(data);
          }, 500);
        } catch (err) {
          console.error("Error con la IA:", err);
          alert("La IA est√° ocupada. Intenta de nuevo.");
        }
      }

      function showAIResults(data: any) {
        loadingBar?.classList.add("hidden");
        results?.classList.remove("hidden");

        if (palette && data.colores) {
          palette.innerHTML = data.colores
            .map(
              (c: string) =>
                `<div class="color-bubble" style="background: ${c}"></div>`
            )
            .join("");
        }

        if (report && data.diagnostico) {
          report.innerHTML = `
        <li><strong>IA Report:</strong> ${data.diagnostico}</li>
        ${data.sugerencias.map((s: string) => `<li><strong>Tip:</strong> ${s}</li>`).join("")}
      `;
        }
      }
    </script>
  </body>
</html>
